<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿è´­ç‰©æŠ˜æ‰£ç³»ç»Ÿï¼ˆå­¦å·æœ«ä½4ï¼‰</title>
    <style>
        body { font-family: "Microsoft YaHei", sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ddd; }
        .form-group { margin: 15px 0; }
        label { display: inline-block; width: 120px; font-weight: bold; }
        input, select { padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #tips { margin: 20px 0; padding: 15px; background: #e9f5ff; border-left: 4px solid #007bff; }
        #clock { font-size: 18px; font-weight: bold; color: #dc3545; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #007bff; color: white; }
        tr:nth-child(even) { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>åœ¨çº¿è´­ç‰©æŠ˜æ‰£è®¢å•ç³»ç»Ÿ</h1>
        <!-- æ¨¡æ‹Ÿæ—¶é’ŸåŒºåŸŸ -->
        <div id="clock"></div>
        
        <!-- è®¢å•è¡¨å• -->
        <div class="form-group">
            <label>å®¢æˆ·åç§°ï¼š</label>
            <input type="text" id="customerName" placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°">
        </div>
        <div class="form-group">
            <label>å•†å“å•ä»·ï¼š</label>
            <input type="number" id="price" placeholder="è¯·è¾“å…¥å¤§äº0çš„æ•°å­—">
        </div>
        <div class="form-group">
            <label>è´­ä¹°æ•°é‡ï¼š</label>
            <input type="number" id="quantity" placeholder="è¯·è¾“å…¥å¤§äº0çš„æ•´æ•°">
        </div>
        <div class="form-group">
            <label>å®¢æˆ·ç±»å‹ï¼š</label>
            <select id="isVip">
                <option value="false">æ™®é€šå®¢æˆ·</option>
                <option value="true">VIPå®¢æˆ·</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ˜¯å¦åŠ æ€¥ï¼š</label>
            <select id="isUrgent">
                <option value="false">å¦</option>
                <option value="true">æ˜¯</option>
            </select>
        </div>
        <button onclick="addOrder()">æ·»åŠ è®¢å•</button>
        
        <!-- è®¢å•è®¡ç®—ç»“æœæç¤º -->
        <div id="tips"></div>
        
        <!-- æˆäº¤å†å²è¡¨æ ¼ -->
        <h2>æˆäº¤å†å²è®°å½•</h2>
        <table id="dashboard">
            <thead>
                <tr>
                    <th>å®¢æˆ·åç§°</th>
                    <th>å•†å“å•ä»·</th>
                    <th>è´­ä¹°æ•°é‡</th>
                    <th>å®¢æˆ·ç±»å‹</th>
                    <th>æ˜¯å¦åŠ æ€¥</th>
                    <th>æœ€ç»ˆæ€»ä»·</th>
                    <th>ä¸‹å•æ—¶é—´</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼šå­˜å‚¨è®¢å•å†å²
        let orderHistory = [];

        // 1. document.write() æç¤ºæŠ˜æ‰£åŠ ä»·è§„åˆ™ï¼ˆé¡µé¢åŠ è½½æ—¶æ‰§è¡Œï¼‰
        document.write('<div style="text-align:center; color:#666; margin:10px 0;">ğŸ’¡ æœ¬è´­ç‰©ç½‘ç«™ï¼šVIPäº«9æŠ˜ï¼ŒåŠ æ€¥é»˜è®¤åŠ 1æˆè´¹ç”¨ï¼Œæ¯å°æ—¶å‰10åˆ†é’Ÿäº«85æŠ˜ï¼›æ™®é€šå®¢æˆ·è®¢å•é‡‘é¢>500å…ƒé¢å¤–9.5æŠ˜ï¼ˆå­¦å·æœ«ä½4ä¸“å±ï¼‰</div>');

        // 2. æ¨¡æ‹Ÿæ—¶é’Ÿå®ç°ï¼ˆå«æ—¶æ®µæŠ˜æ‰£æç¤ºï¼‰
        function updateClock() {
            const now = new Date();
            const hour = now.getHours().toString().padStart(2, '0');
            const minute = now.getMinutes().toString().padStart(2, '0');
            const second = now.getSeconds().toString().padStart(2, '0');
            const week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()];
            const date = `${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥`;
            
            // æ—¶é’Ÿæ˜¾ç¤ºå†…å®¹
            let clockText = `${date} æ˜ŸæœŸ${week} ${hour}:${minute}:${second}`;
            // æ—¶æ®µæŠ˜æ‰£åˆ¤æ–­ï¼ˆåŸºç¡€è§„åˆ™ï¼šå‰10åˆ†é’Ÿ85æŠ˜ï¼‰
            if (now.getMinutes() < 10) {
                clockText += ' | ğŸ‰ å½“å‰æ—¶æ®µäº«85æŠ˜ä¼˜æƒ ï¼';
            } else {
                clockText += ' | â° å½“å‰æ—¶æ®µæ— é¢å¤–æŠ˜æ‰£';
            }
            document.getElementById('clock').innerText = clockText;
        }
        // åˆå§‹åŒ–æ—¶é’Ÿå¹¶æ¯ç§’æ›´æ–°
        updateClock();
        setInterval(updateClock, 1000);

        // 3. è¡¨å•æ•°æ®æ ¡éªŒå‡½æ•°
        function validateForm(customerName, price, quantity) {
            // æ ¡éªŒå®¢æˆ·åç§°éç©º
            if (!customerName.trim()) {
                alert('å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼');
                return false;
            }
            // æ ¡éªŒå•†å“å•ä»·ï¼šå¤§äº0çš„æ•°å­—
            if (isNaN(price) || price <= 0) {
                alert('å•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—ï¼');
                return false;
            }
            // æ ¡éªŒæ•°é‡ï¼šå¤§äº0çš„æ•´æ•°
            if (isNaN(quantity) || quantity <= 0 || !Number.isInteger(quantity)) {
                alert('è´­ä¹°æ•°é‡å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°ï¼');
                return false;
            }
            return true;
        }

        // 4. æ·»åŠ è®¢å•æ ¸å¿ƒå‡½æ•°ï¼ˆå«å­¦å·æœ«ä½4çš„æŠ˜æ‰£é€»è¾‘ï¼‰
        function addOrder() {
            // 1. è·å–è¡¨å•æ•°æ®
            const customerName = document.getElementById('customerName').value;
            const price = parseFloat(document.getElementById('price').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const isVip = document.getElementById('isVip').value === 'true';
            const isUrgent = document.getElementById('isUrgent').value === 'true';
            const now = new Date();
            const minute = now.getMinutes();

            // 2. æ•°æ®æ ¡éªŒ
            if (!validateForm(customerName, price, quantity)) {
                return;
            }

            // 3. æŠ˜æ‰£/åŠ ä»·è®¡ç®—
            let baseTotal = price * quantity; // åŸºç¡€æ€»ä»·
            let afterVip = baseTotal;
            let afterUrgent = baseTotal;
            let finalTotal = baseTotal;
            let hitTimeDiscount = false; // æ˜¯å¦å‘½ä¸­æ—¶æ®µæŠ˜æ‰£

            // VIPæŠ˜æ‰£ï¼ˆ9æŠ˜ï¼‰
            if (isVip) {
                afterVip = baseTotal * 0.9;
            }

            // åŠ æ€¥è´¹ç”¨ï¼ˆåŸºç¡€è§„åˆ™ï¼šåŠ 1æˆï¼‰
            afterUrgent = afterVip;
            if (isUrgent) {
                afterUrgent = afterVip * 1.1;
            }

            // æ—¶æ®µæŠ˜æ‰£ï¼ˆåŸºç¡€è§„åˆ™ï¼šå‰10åˆ†é’Ÿ85æŠ˜ï¼‰
            if (minute < 10) {
                hitTimeDiscount = true;
                finalTotal = afterUrgent * 0.85;
            } else {
                finalTotal = afterUrgent;
            }

            // --------------------------
            // å­¦å·æœ«ä½4ä¸“å±è§„åˆ™ï¼šéVIP + é€šç”¨æŠ˜æ‰£åé‡‘é¢>500å…ƒ â†’ é¢å¤–9.5æŠ˜
            // --------------------------
            if (!isVip && finalTotal > 500) {
                finalTotal = finalTotal * 0.95;
                // æç¤ºä¿¡æ¯è¿½åŠ ï¼ˆå¯é€‰ï¼Œå¢å¼ºç”¨æˆ·æ„ŸçŸ¥ï¼‰
                document.getElementById('tips').setAttribute('data-rule4', 'å·²è§¦å‘å­¦å·æœ«ä½4è§„åˆ™ï¼šæ™®é€šå®¢æˆ·è®¢å•>500å…ƒé¢å¤–9.5æŠ˜');
            }

            // ä¿ç•™2ä½å°æ•°ï¼ˆé‡‘é¢è§„èŒƒï¼‰
            baseTotal = baseTotal.toFixed(2);
            afterVip = afterVip.toFixed(2);
            afterUrgent = afterUrgent.toFixed(2);
            finalTotal = finalTotal.toFixed(2);

            // 4. æ‹¼æ¥æç¤ºä¿¡æ¯å¹¶å±•ç¤º
            let tipsHtml = `
                <p>å®¢æˆ·åç§°ï¼š${customerName}</p>
                <p>åŸºç¡€æ€»ä»·ï¼ˆå•ä»·Ã—æ•°é‡ï¼‰ï¼šÂ¥${baseTotal}</p>
                <p>VIPæŠ˜æ‰£åä»·æ ¼ï¼šÂ¥${afterVip}</p>
                <p>åŠ æ€¥è´¹ç”¨åä»·æ ¼ï¼šÂ¥${afterUrgent}</p>
                <p>æ—¶æ®µæŠ˜æ‰£ï¼š${hitTimeDiscount ? 'äº«85æŠ˜' : 'æ— '}</p>
                ${!isVip && parseFloat(finalTotal) > 500 ? '<p>âœ… å­¦å·ä¸“å±ä¼˜æƒ ï¼šæ™®é€šå®¢æˆ·è®¢å•>500å…ƒï¼Œé¢å¤–9.5æŠ˜</p>' : ''}
                <p>æœ€ç»ˆæ€»ä»·ï¼šÂ¥${finalTotal}</p>
            `;
            document.getElementById('tips').innerHTML = tipsHtml;

            // 5. ä¿å­˜è®¢å•åˆ°å†å²è®°å½•
            const order = {
                customerName,
                price: price.toFixed(2),
                quantity,
                isVip: isVip ? 'VIPå®¢æˆ·' : 'æ™®é€šå®¢æˆ·',
                isUrgent: isUrgent ? 'æ˜¯' : 'å¦',
                finalTotal,
                time: `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()} ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`
            };
            orderHistory.push(order);

            // 6. æ¸²æŸ“æˆäº¤å†å²è¡¨æ ¼
            renderDashboard();

            // æ¸…ç©ºè¡¨å•ï¼ˆä¼˜åŒ–ä½“éªŒï¼‰
            document.getElementById('customerName').value = '';
            document.getElementById('price').value = '';
            document.getElementById('quantity').value = '';
        }

        // 5. æ¸²æŸ“æˆäº¤å†å²è¡¨æ ¼
        function renderDashboard() {
            const tbody = document.querySelector('#dashboard tbody');
            // æ¸…ç©ºåŸæœ‰å†…å®¹
            tbody.innerHTML = '';
            // éå†è®¢å•å†å²ï¼Œé€è¡Œæ·»åŠ 
            orderHistory.forEach(order => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.customerName}</td>
                    <td>Â¥${order.price}</td>
                    <td>${order.quantity}</td>
                    <td>${order.isVip}</td>
                    <td>${order.isUrgent}</td>
                    <td>Â¥${order.finalTotal}</td>
                    <td>${order.time}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>

